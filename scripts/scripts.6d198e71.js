"use strict";angular.module("workanizerApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","indexedDB","mwl.bluebird"]).config(["$routeProvider","$indexedDBProvider",function(a,b){b.connection("workanizerDB").upgradeDatabase(1,function(a,b,c){var d=b.createObjectStore("worklist",{keyPath:"id",autoIncrement:!0});d.createIndex("name_idx","name",{unique:!0}),d.createIndex("id_idx","id",{unique:!0})}),b.connection("workanizerDB").upgradeDatabase(2,function(a,b,c){var d=b.createObjectStore("workitem",{keyPath:"id",autoIncrement:!0});d.createIndex("id_idx","id",{unique:!0}),d.createIndex("worklist_idx","worklistId",{unique:!1})}),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]),angular.module("mwl.bluebird").run(["$q","$log",function(a,b){a.onPossiblyUnhandledRejection(function(a){console.warn("Unhandled promise rejection: "+a)})}]),angular.module("workanizerApp").controller("MainCtrl",["WorklistRepository",function(a){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],console.log("MainCtrl"),a.findAll()}]),angular.module("workanizerApp").controller("AboutCtrl",["WorklistRepository",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);var Workanizer=Workanizer||{};Workanizer.WorklistRepository=function(a,b){this.$indexedDB=a,this.$q=b},Workanizer.WorklistRepository.prototype.findAll=function(){var a=this.$q.defer();return this.$indexedDB.openStore("worklist",function(b){b.getAll().then(function(b){a.resolve(b)})}),a.promise},Workanizer.WorklistRepository.prototype.findOne=function(a){var b=this.$q.defer();return this.$indexedDB.openStore("worklist",function(c){c.find(a).then(function(a){b.resolve(a)})}),b.promise},Workanizer.WorklistRepository.prototype.save=function(a){if(!this.isWorklist(a))throw"Object is not a workList: "+a;return this.$indexedDB.openStore("worklist",function(b){b.insert(a)})},Workanizer.WorklistRepository.prototype.createWorklist=function(a){return{name:a}},Workanizer.WorklistRepository.prototype.isWorklist=function(a){return angular.isObject(a)&&"string"==typeof a.name},Workanizer.WorklistRepository.prototype.deleteAll=function(){return this.$indexedDB.openStore("worklist",function(a){a.clear()})},angular.module("workanizerApp").service("WorklistRepository",["$indexedDB","$q",Workanizer.WorklistRepository]);var Workanizer=Workanizer||{};Workanizer.WorkitemRepository=function(a,b){this.$indexedDB=a,this.$q=b},Workanizer.WorkitemRepository.prototype.save=function(a){if(!this.isWorkitem(a))throw"Object is not a Workitem: "+a;return this.$indexedDB.openStore("workitem",function(b){b.upsert(a)})},Workanizer.WorkitemRepository.prototype.findByWorklist=function(a){var b=this.$q.defer();return this.$indexedDB.openStore("workitem",function(c){var d=c.query();d=d.$eq(a),d=d.$index("worklist_idx"),c.findWhere(d).then(function(a){b.resolve(a)})}),b.promise},Workanizer.WorkitemRepository.prototype.createWorkitem=function(a,b){return{text:a,done:!1,createdAt:new Date,worklistId:b}},Workanizer.WorkitemRepository.prototype.isWorkitem=function(a){return angular.isObject(a)&&"string"==typeof a.text},Workanizer.WorkitemRepository.prototype.deleteAll=function(){return this.$indexedDB.openStore("workitem",function(a){a.clear()})},angular.module("workanizerApp").service("WorkitemRepository",["$indexedDB","$q",Workanizer.WorkitemRepository]),angular.module("workanizerApp").controller("PageController",["$scope","WorklistRepository","WorkitemRepository","$q","$indexedDB",function(a,b,c,d,e){function f(){a.worklists=[],b.findAll().then(function(b){a.worklists=b,a.worklists.length>0&&(a.activeWorklist=a.worklists[0],g())})}function g(){a.workitems=[],c.findByWorklist(a.activeWorklist.id).then(function(b){a.workitems=b})}f(),a.activateWorklist=function(b){a.activeWorklist=b,g()},a.createWorklist=function(c){var d=b.createWorklist(c);b.save(d).then(function(){a.worklists.push(d),a.newWorklistName=""})},a.createWorkitem=function(b){var d=c.createWorkitem(b,a.activeWorklist.id);c.save(d).then(function(){a.workitems.push(d),a.newWorkitemText=""})},a.updateItem=function(a){c.save(a)},a.resetDatabase=function(){e.deleteDatabase().then(function(){var a=[];a.push(b.save(b.createWorklist("Today"))),a.push(b.save(b.createWorklist("Trash"))),a.push(c.save(c.createWorkitem("Write Mail to Sally",1))),a.push(c.save(c.createWorkitem("Get Groceries",2))),d.all(a).then(function(a){f()})})}}]),angular.module("workanizerApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/main.html",'<div class="jumbotron"> <h1>\'Allo, \'Allo!</h1> <p class="lead"> <img src="images/yeoman.c582c4d1.png" alt="I\'m Yeoman"><br> Always a pleasure scaffolding your apps. </p> <p><a class="btn btn-lg btn-success" ng-href="#/">Splendid!<span class="glyphicon glyphicon-ok"></span></a></p> </div> <div class="row marketing"> <h4>HTML5 Boilerplate</h4> <p> HTML5 Boilerplate is a professional front-end template for building fast, robust, and adaptable web apps or sites. </p> <h4>Angular</h4> <p> AngularJS is a toolset for building the framework most suited to your application development. </p> <h4>Karma</h4> <p>Spectacular Test Runner for JavaScript.</p> </div>')}]);